(this["webpackJsonpvery-interesting"]=this["webpackJsonpvery-interesting"]||[]).push([[0],{126:function(e,t,n){e.exports={"lds-ring":"loader_lds-ring__1FZhz"}},128:function(e,t,n){e.exports={"toggle-btn":"authPage_toggle-btn__l4UTG"}},162:function(e,t,n){},21:function(e,t,n){e.exports={wrapper:"booksItem_wrapper__3PGnD",title:"booksItem_title__1fPmx",list:"booksItem_list__37gi0",item:"booksItem_item__Gy8Gv",field:"booksItem_field__ycqMz",value:"booksItem_value__mTYYE",controls:"booksItem_controls__3Sg39",control:"booksItem_control__2Lm2I"}},267:function(e,t,n){"use strict";n.r(t);var r=n(3),a=n(2),i=n.n(a),o=n(68),s=n.n(o),c=(n(162),n(34)),u=n(35),l=n(38),b=n(37),d=n(9),j=n(18),p=n(17),f=n.n(p),h=n(28),m=n(14),O=n(99);O.a.initializeApp({apiKey:"AIzaSyCJryPWbbHUEDUYCpFmIMk4biYmGW9cGwI",authDomain:"test-task-very-interesting.firebaseapp.com",projectId:"test-task-very-interesting",storageBucket:"test-task-very-interesting.appspot.com",messagingSenderId:"669971670276",appId:"1:669971670276:web:ae501f1e510489b9679c51"});var g,x=O.a.firestore(),v=function(e){return x.collection("users").doc(e.toLowerCase()).get().then((function(e){return e}))},k=function(e,t){return x.collection("users").doc(e.toLowerCase()).set({email:e,password:t}).then((function(){return!0}))},S=function(e){return x.collection("books").doc(e).get().then((function(e){return e}))},_=function(e,t,n,r){return x.collection("books").doc(r).set({title:e,authors:t,date:n,ISBN:r}).then((function(){return!0}))},I=function(){return x.collection("books")},y=function(e){return x.collection("books").doc(e).delete().then((function(){return!0}))},N=n(31),w="SET_USER0DATA",B="TOGGLE_IS_SENDING",E={isAuth:!1,isSending:!1,email:null},A=function(e,t){return{type:w,isAuth:e,email:t}},F=function(e){return{type:B,isSending:e}},D=function(e){localStorage.setItem("user",e)},C=function(e){return function(t,n){return function(){var r=Object(h.a)(f.a.mark((function r(a){var i;return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a(F(!0)),r.next=3,v(t,n);case 3:i=r.sent,e(t,n,i,a),a(F(!1));case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}},P=function(){var e=Object(h.a)(f.a.mark((function e(t,n,r,a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.exists&&a(Object(N.a)("registration",{_error:"this email is already taken"})),r.exists){e.next=6;break}return e.next=4,k(t,n).catch((function(e){return a(Object(N.a)("registration",{_error:e}))}));case 4:a(A(!0,t)),D(t);case 6:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),G=C((function(e,t,n,r){n.exists&&n.data().password===t?(r(A(!0,e)),D(e)):r(Object(N.a)("login",{_error:"Incorrect email or password"}))})),T=C(P),z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case w:return Object(m.a)(Object(m.a)({},e),{},{isAuth:t.isAuth,email:t.email});case B:return Object(m.a)(Object(m.a)({},e),{},{isSending:t.isSending});default:return e}},L="INITIALIZED-SUCCESS",R={initialized:!1},U=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case L:return Object(m.a)(Object(m.a)({},e),{},{initialized:!0});default:return e}},M=function(e){return e.auth.isAuth},Z=function(e){return e.auth.isSending},K=function(e){return e.auth.email},Y=function(e){return e.library.isFetching},J=function(e){return e.library.books},V=function(e){return e.library.deletingInProgress},W=function(e){return e.library.activeBook},$=function(e){return e.library.isSending},X=function(e){return e.library.successSend},q=function(e){return e.initial.initialized},H=n(16),Q=n(91),ee=n.n(Q),te=n(25),ne=n(21),re=n.n(ne),ae=function(e){var t=e.bookInfo,n=e.deleteBook,a=e.deletingInProgress;return Object(r.jsxs)("article",{className:re.a.wrapper,children:[Object(r.jsx)("h2",{className:re.a.title,children:t.title}),Object(r.jsxs)("ul",{className:re.a.list,children:[Object(r.jsxs)("li",{className:re.a.item,children:[Object(r.jsx)("span",{className:re.a.field,children:"Date of issue:"}),Object(r.jsx)("span",{className:re.a.value,children:t.date})]}),Object(r.jsxs)("li",{className:re.a.item,children:[Object(r.jsx)("span",{className:re.a.field,children:"Authors:"}),Object(r.jsx)("span",{className:re.a.value,children:t.authors})]}),Object(r.jsxs)("li",{className:re.a.item,children:[Object(r.jsx)("span",{className:re.a.field,children:"ISBN:"}),Object(r.jsx)("span",{className:re.a.value,children:t.ISBN})]})]}),Object(r.jsxs)("div",{className:re.a.controls,children:[Object(r.jsx)(te.b,{to:"/book/".concat(t.ISBN),className:"btn btn-warning ".concat(re.a.control),children:"Edit"}),Object(r.jsx)("button",{className:"btn btn-danger ".concat(re.a.control),disabled:a.some((function(e){return e===t.ISBN})),onClick:function(){return n(t.ISBN)},children:"Delete"})]})]})},ie=function(e){var t=e.books,n=e.deleteBook,a=e.deletingInProgress,i=[];return t.forEach((function(e){i.push(Object(r.jsx)(ae,{bookInfo:e.data(),deleteBook:n,deletingInProgress:a},e.id))})),Object(r.jsx)("ul",{children:i})},oe=n(126),se=n.n(oe),ce=function(){return Object(r.jsxs)("div",{className:se.a["lds-ring"],children:[Object(r.jsx)("div",{}),Object(r.jsx)("div",{}),Object(r.jsx)("div",{}),Object(r.jsx)("div",{})]})},ue=function(e){var t=e.books,n=e.isFetching,a=e.deleteBook,i=e.deletingInProgress;return Object(r.jsx)("section",{className:"wrapper",children:Object(r.jsxs)("div",{className:"container",children:[Object(r.jsx)("h1",{className:"title",children:"Library"}),Object(r.jsx)(te.b,{to:"/book",className:"btn ".concat(ee.a["add-btn"]),children:"Add new book"}),n?Object(r.jsx)(ce,{}):Object(r.jsx)(r.Fragment,{children:t.size>0?Object(r.jsx)(ie,{books:t,deleteBook:a,deletingInProgress:i}):Object(r.jsx)("p",{className:"alert alert-warning ".concat(ee.a.alert),children:"There are no books yet"})})]})})},le=function(e){return{isAuth:M(e)}},be=function(e){var t=function(t){Object(l.a)(a,t);var n=Object(b.a)(a);function a(){return Object(c.a)(this,a),n.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){return this.props.isAuth?Object(r.jsx)(e,Object(m.a)({},this.props)):Object(r.jsx)(H.a,{to:"/auth"})}}]),a}(i.a.Component);return Object(j.b)(le)(t)},de=n(100),je="SET_BOOKS",pe="ET_ACTIVE_BOOK",fe="TOGGLE-IS-FETCHING",he="TOGGLE_IS_DELETING_PROGRESS",me="TOGGLE_IS_SENDING",Oe="TOGGLE_SUCCESS_SEND",ge={books:[],isFetching:!0,deletingInProgress:[],activeBook:{},isSending:!1,successSend:!1},xe=function(e){return{type:pe,bookInfo:e}},ve=function(e){return{type:fe,isFetching:e}},ke=function(e){return{type:me,isSending:e}},Se=function(e){return{type:Oe,successSend:e}},_e=function(e,t){return{type:he,isFetching:e,ISBN:t}},Ie=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r;return function(){var i=Object(h.a)(f.a.mark((function i(o){return f.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o(ke(!0)),i.next=3,_(e,t,n,r,a).catch((function(e){return o(ke(!1)),o(Object(N.a)("book",{_error:e}))}));case 3:i.sent&&(o(Se(!0)),o(Se(!1))),o(ke(!1));case 7:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()},ye=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ge,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case je:return Object(m.a)(Object(m.a)({},e),{},{books:t.books});case pe:return Object(m.a)(Object(m.a)({},e),{},{activeBook:t.bookInfo});case fe:return Object(m.a)(Object(m.a)({},e),{},{isFetching:t.isFetching});case me:return Object(m.a)(Object(m.a)({},e),{},{isSending:t.isSending});case Oe:return Object(m.a)(Object(m.a)({},e),{},{successSend:t.successSend});case he:return Object(m.a)(Object(m.a)({},e),{},{deletingInProgress:t.isFetching?[].concat(Object(de.a)(e.deletingInProgress),[t.ISBN]):Object(de.a)(e.deletingInProgress.filter((function(e){return e!==t.ISBN})))});default:return e}},Ne=function(e){Object(l.a)(n,e);var t=Object(b.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"componentDidMount",value:function(){this.props.toggleSubscribeBooks()}},{key:"render",value:function(){return Object(r.jsx)(ue,{books:this.props.books,isFetching:this.props.isFetching,deleteBook:this.props.deleteBook,deletingInProgress:this.props.deletingInProgress})}}]),n}(i.a.Component),we={toggleSubscribeBooks:function(){return function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I().onSnapshot((function(e){t(ve(!0)),t({type:je,books:e}),t(ve(!1))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},deleteBook:function(e){return function(){var t=Object(h.a)(f.a.mark((function t(n){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n(_e(!0,e)),t.next=3,y(e);case 3:n(_e(!1,e));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}},Be=Object(d.d)(be,Object(j.b)((function(e){return{isFetching:Y(e),books:J(e),deletingInProgress:V(e)}}),we))(Ne),Ee=n(130),Ae=n(122),Fe=n(123),De=n(131),Ce=n(94),Pe=n.n(Ce),Ge=function(e){var t=e.input,n=e.meta,a=e.label,i=Object(De.a)(e,["input","meta","label"]),o=n.touched&&n.error;return Object(r.jsxs)("div",{className:Pe.a["field-wrapper"],children:[a&&Object(r.jsx)("label",{htmlFor:i.id,children:a}),Object(r.jsx)("input",Object(m.a)(Object(m.a)(Object(m.a)({},t),i),{},{className:"form-control ".concat(Pe.a.control)})),o&&Object(r.jsxs)("p",{className:"alert alert-danger",children:[" ",n.error," "]})]})},Te=function(e){return e?void 0:"Field is required"},ze=function(e,t){return e!==t.password?"Passwords don't match":void 0},Le=function(e){return e&&!/^[\u0430-\u044f\u0451a-z0-9]+$/i.test(e)?"Invalid password should contain only letters and digits":void 0},Re=function(e){return e&&!/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(e)?"Invalid email":void 0},Ue=function(e){return e&&!/^[\u0430-\u044f\u0451a-z.,;-]+[\u0430-\u044f\u0451a-z.,;-\s]+$/i.test(e)?'Invalid string\n  should contain only letters and ".,-;"':void 0},Me=function(e){return e&&!/^[\u0430-\u044f\u0451a-z0-9]+/i.test(e)?"Invalid titile":void 0},Ze=function(e){return new Date(e)>new Date?"Date can't be in future":void 0},Ke=function(e){return e&&!/^[0-9]+$/.test(e)?"Should contain only numbers":void 0},Ye=function(e,t){var n=new Date(2007,0,1,0,0,0,0),r=new Date(t.date);if(r){if(r>n)return 13!==e.length&&"from this date should contain 13 digits";if(r<=n)return 10!==e.length&&"from this date should contain 10 digits"}},Je=n(95),Ve=n.n(Je),We=(g=9,function(e){return e.length<g?"Minlength ".concat(g," symbols"):void 0}),$e=function(e){var t=e.title,n=e.isLogin,a=void 0!==n&&n,i=e.handleSubmit,o=e.error,s=e.isSending,c=a?[Te]:[Te,Le,We],u=a?[Te]:[Te,Re];return Object(r.jsxs)("form",{className:Ve.a.form,onSubmit:i,children:[Object(r.jsx)(Ae.a,{type:"email",name:"email",placeholder:"Email",component:Ge,validate:u,autoComplete:"on"}),Object(r.jsx)(Ae.a,{type:"password",name:"password",placeholder:"Password",component:Ge,validate:c,autoComplete:"off"}),!a&&Object(r.jsx)(Ae.a,{type:"password",name:"Repeat-password",placeholder:"Repeat password",component:Ge,validate:[Te,ze],autoComplete:"off"}),o&&Object(r.jsx)("p",{className:"alert alert-danger",children:o}),Object(r.jsx)("button",{type:"submit",className:"btn btn-primary ".concat(Ve.a["submit-btn"]),disabled:s,children:t})]})},Xe=Object(Fe.a)({form:"login"})($e),qe=Object(Fe.a)({form:"registration"})($e),He=n(128),Qe=n.n(He),et=function(e){var t=e.isAuth,n=e.login,i=e.registration,o=e.isSending,s=Object(a.useState)(!0),c=Object(Ee.a)(s,2),u=c[0],l=c[1],b=u?"Login":"Registration",d=u?"Registration":"Login";return t?Object(r.jsx)(H.a,{to:"/library"}):Object(r.jsx)("section",{className:"wrapper",children:Object(r.jsxs)("div",{className:"container",children:[Object(r.jsx)("h2",{className:"title",children:b}),u?Object(r.jsx)(Xe,{title:b,isLogin:u,onSubmit:function(e){var t=e.email,r=e.password;n(t,r)},isSending:o}):Object(r.jsx)(qe,{title:b,onSubmit:function(e){var t=e.email,n=e.password;i(t,n)},isSending:o}),Object(r.jsx)("button",{onClick:function(){l(!u)},className:Qe.a["toggle-btn"],children:d})]})})},tt={login:G,registration:T},nt=Object(d.d)(Object(j.b)((function(e){return{isAuth:M(e),isSending:Z(e)}}),tt))(et),rt=n(98),at=n.n(rt),it=Object(Fe.a)({form:"book"})((function(e){var t=e.title,n=e.handleSubmit,a=e.error,i=e.isSending,o=e.onlyRedaction;return Object(r.jsxs)("form",{onSubmit:n,className:at.a.form,children:[Object(r.jsx)(Ae.a,{type:"text",name:"title",label:"Title:",id:"title",placeholder:"Title",component:Ge,validate:[Te,Me],autoComplete:"on"}),Object(r.jsx)(Ae.a,{type:"text",name:"authors",label:"Authors:",id:"Authors",placeholder:"Authors",component:Ge,validate:[Te,Ue],autoComplete:"on"}),Object(r.jsx)(Ae.a,{type:"date",name:"date",label:"Date:",id:"Date",placeholder:"Date",component:Ge,validate:[Te,Ze],autoComplete:"on"}),Object(r.jsx)(Ae.a,{type:"text",name:"ISBN",label:"ISBN:",id:"ISBN",placeholder:"ISBN",component:Ge,validate:[Te,Ke,Ye],autoComplete:"on",readOnly:o}),a&&Object(r.jsx)("p",{className:"alert alert-danger",children:a}),Object(r.jsx)("button",{type:"submit",className:"btn btn-primary ".concat(at.a["submit-btn"]),disabled:i,children:t})]})})),ot=function(e){var t=e.addNewBook,n=e.updateBookInfo,a=e.bookInfo,i=e.isFetching,o=e.isSending;return e.successSend?Object(r.jsx)(H.a,{to:"/library"}):Object(r.jsx)("section",{className:"wrapper",children:Object(r.jsxs)("div",{className:"container",children:[Object(r.jsx)(te.b,{to:"/library",className:"link-back",children:"Back to library"}),Object(r.jsx)("h2",{className:"title",children:"Book"}),i?Object(r.jsx)(ce,{}):Object(r.jsx)(r.Fragment,{children:a?Object(r.jsx)(it,{title:"Save",onSubmit:function(e){var t=e.title,r=e.authors,i=e.date,o=e.ISBN;n(t,r,i,o,a.ISBN)},initialValues:a,isSending:o,onlyRedaction:!0}):Object(r.jsx)(it,{title:"Add",onSubmit:function(e){var n=e.title,r=e.authors,a=e.date,i=e.ISBN;t(n,r,a,i)},isSending:o})})]})})},st=function(e){Object(l.a)(n,e);var t=Object(b.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"getActualBookData",value:function(){var e=this.props.match.params.ISBN;this.props.getBookInfo(e)}},{key:"componentDidMount",value:function(){console.log(this.props.match.params.ISBN),this.getActualBookData()}},{key:"componentDidUpdate",value:function(e){this.props.match.params.ISBN!==e.match.params.ISBN&&this.getActualBookData()}},{key:"render",value:function(){return Object(r.jsx)(ot,{addNewBook:this.props.addNewBook,updateBookInfo:this.props.setBook,bookInfo:this.props.bookInfo,isFetching:this.props.isFetching,isSending:this.props.isSending,successSend:this.props.successSend})}}]),n}(i.a.Component),ct={getBookInfo:function(e){return function(){var t=Object(h.a)(f.a.mark((function t(n){var r;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n(ve(!0)),e){t.next=5;break}n(xe(null)),t.next=9;break;case 5:return t.next=7,S(e);case 7:r=t.sent,n(xe(r.data()));case 9:setTimeout((function(){n(ve(!1))}),0);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},addNewBook:function(e,t,n,r){return function(){var a=Object(h.a)(f.a.mark((function a(i){var o;return f.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i(ke(!0)),a.next=3,S(r);case 3:(o=a.sent).exists&&i(Object(N.a)("book",{_error:"this ISBN is already taken"})),o.exists||i(Ie(e,t,n,r)),i(ke(!1));case 7:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()},setBook:Ie},ut=Object(d.d)(Object(j.b)((function(e){return{bookInfo:W(e),isFetching:Y(e),isSending:$(e),successSend:X(e)}}),ct),H.g,be)(st),lt=n(59),bt=n.n(lt),dt=function(e){var t=e.isAuth,n=e.email,a=e.logout;return Object(r.jsx)("header",{className:bt.a.header,children:Object(r.jsx)("div",{className:"container ".concat(bt.a.wrapper),children:t&&Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("p",{className:bt.a.email,children:n}),Object(r.jsx)("button",{className:bt.a.btn,onClick:a,children:"logout"})]})})})},jt={logout:function(){return function(e){e(A(!1,null)),localStorage.removeItem("user")}}},pt=Object(d.d)(Object(j.b)((function(e){return{isAuth:M(e),email:K(e)}}),jt))(dt);var ft=function(){return Object(r.jsxs)("main",{children:[Object(r.jsx)(pt,{}),Object(r.jsxs)(H.d,{children:[Object(r.jsx)(H.b,{path:"/",exact:!0,render:function(){return Object(r.jsx)(H.a,{to:"/library"})}}),Object(r.jsx)(H.b,{path:"/auth",render:function(){return Object(r.jsx)(nt,{})}}),Object(r.jsx)(H.b,{path:"/book/:ISBN?",render:function(){return Object(r.jsx)(ut,{})}}),Object(r.jsx)(H.b,{path:"/library",render:function(){return Object(r.jsx)(Be,{})}}),Object(r.jsx)(H.b,{path:"*",render:function(){return Object(r.jsx)("div",{className:"container alert alert-danger not-found",children:"404 PAGE NOT FOUND"})}})]})]})},ht=function(e){Object(l.a)(n,e);var t=Object(b.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"componentDidMount",value:function(){this.props.initializeApp()}},{key:"render",value:function(){return this.props.initialized?Object(r.jsx)(ft,{}):Object(r.jsx)(ce,{})}}]),n}(i.a.Component),mt={initializeApp:function(){return function(){var e=Object(h.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t((function(e){var t=localStorage.getItem("user");t&&e(A(!0,t))}));case 2:t({type:L});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},Ot=Object(d.d)(Object(j.b)((function(e){return{initialized:q(e)}}),mt))(ht),gt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,268)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),i(e),o(e)}))},xt=n(124),vt=n(129),kt=Object(d.c)({initial:U,auth:z,library:ye,form:xt.a}),St=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||d.d,_t=Object(d.e)(kt,St(Object(d.a)(vt.a)));window.store=_t;var It=_t;s.a.render(Object(r.jsx)(te.a,{basename:"/test-for-very-interesting",children:Object(r.jsx)(j.a,{store:It,children:Object(r.jsx)(Ot,{})})}),document.getElementById("root")),gt()},59:function(e,t,n){e.exports={header:"header_header__3mu8Z",wrapper:"header_wrapper__1V7lE",email:"header_email__3OWYD",btn:"header_btn__1Oulx"}},91:function(e,t,n){e.exports={"add-btn":"libraryPage_add-btn__1_s7r",alert:"libraryPage_alert__3GGMk"}},94:function(e,t,n){e.exports={"field-wrapper":"formsControls_field-wrapper__3PWku",control:"formsControls_control__2sK7d"}},95:function(e,t,n){e.exports={form:"authForm_form__3KzO3","submit-btn":"authForm_submit-btn__3XJEw"}},98:function(e,t,n){e.exports={form:"bookForm_form__3jmEc","submit-btn":"bookForm_submit-btn__2P7_4"}}},[[267,1,2]]]);
//# sourceMappingURL=main.4589c11f.chunk.js.map